<?xml version='1.0' encoding='UTF-8'?>
<project>
<actions/>
<description>{% block description %}{% if job.description is not empty %}{{ job.description }}{% endif %}{% endblock description %}</description>
{% block logRotator %}
    <logRotator>
        <daysToKeep>{{ job.payload.logrotate_days }}</daysToKeep>
        <numToKeep>-1</numToKeep>
        <artifactDaysToKeep>{{ job.payload.logrotate_days }}</artifactDaysToKeep>
        <artifactNumToKeep>-1</artifactNumToKeep>
    </logRotator>
{% endblock logRotator %}
<keepDependencies>false</keepDependencies>
<properties/>
<scm class='hudson.scm.NullSCM'/>
<canRoam>true</canRoam>
<disabled>{% block disable %}{{ not job.enable }}{% endblock disable %}</disabled>
<blockBuildWhenDownstreamBuilding>false</blockBuildWhenDownstreamBuilding>
<blockBuildWhenUpstreamBuilding>false</blockBuildWhenUpstreamBuilding>
{% block triggers %}
    <triggers class='vector'>
        <hudson.triggers.TimerTrigger>
            <spec>{{ job.repeat_pattern }}</spec>
        </hudson.triggers.TimerTrigger>
    </triggers>
{% endblock triggers %}
<concurrentBuild>false</concurrentBuild>
<builders>
    <hudson.tasks.Shell>
        <command><![CDATA[
docker exec -i -u spryker \
  -e APPLICATION_ENV={{ getenv('APPLICATION_ENV') }} \
  -e APPLICATION_STORE={{ job.store }} \
  -e PHP_BIN="/usr/bin/php" \
  {{ getenv('SPRYKER_JOB_CONTAINER') | replace({ '%store%': job.store|lower }) }} \
  bash -c \
  "{{ job.command }}"
        ]]></command>
    </hudson.tasks.Shell>
</builders>
{% block publishers %}
    {% if job.notifications is defined and job.notifications is iterable %}
        <publishers>
            <hudson.tasks.Mailer>
                <recipients>{{ job.notifications|split(',') }}</recipients>
                <dontNotifyEveryUnstableBuild>false</dontNotifyEveryUnstableBuild>
                <sendToIndividuals>false</sendToIndividuals>
            </hudson.tasks.Mailer>
        </publishers>
    {% else %}
        <publishers/>
    {% endif %}
{% endblock publishers %}
<buildWrappers/>
</project>

